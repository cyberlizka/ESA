# Практическая работа №4. Java Message Service (JMS)
## Общее задание
Вам необходимо добавить новую функциональность в предыдущее приложение, а именно механизм журналирования и систему оповещения об изменениях. Журналирование должно предоставлять простой механизм для записи информации об изменениях в вашей системе в специальную таблицу базы данных. Система оповещения должна отправлять уведомления об изменениях в системе на указанные адреса электронной почты. Настоятельно рекомендуется использовать систему контроля версий и управления исходным кодом (например, GitHub). Вы можете выбрать любую IDE.

### Задание 1
*Добавьте новую таблицу в базу данных для журналирования изменений.*

#### Реализация
В базе данных создана таблица `log`, содержащая информацию обо всех изменениях сущностей:

- имя сущности;
- идентификатор сущности;
- тип изменения (INSERT, UPDATE, DELETE);
- детали изменения (новые значения полей).

Для работы с таблицей реализованы:
- сущность `Log`;
- репозиторий `LogRepository`;
- сервис `LogService`.
### Задание 2

*Создайте и настройте административные объекты JMS на сервере приложений.*

#### Реализация
Для реализации обмена сообщениями используется **Spring JMS** и брокер сообщений **ActiveMQ**.

Настроены:
- очередь `entityChangeQueue`;
- `JmsTemplate` для отправки сообщений;
- JSON-конвертация сообщений.

JMS-конфигурация вынесена в класс `JmsConfig`.

### Задание 3
*Измените приложение так, чтобы оно отправляло сообщения при изменении сущностей.*

#### Реализация
При каждом изменении сущностей (`Doctor`, `ShiftReport`) в сервисном слое:
- формируется объект `EntityChangeMessage`;
- сообщение отправляется в очередь `entityChangeQueue`.

Сообщение содержит:
- имя сущности;
- идентификатор сущности;
- тип изменения;
- описание изменения.
### Задание 4
*Разработайте MDB или MDP для получения сообщений и записи изменений в журнал.*

#### Реализация
Реализован **Message-Driven POJO** на базе Spring:

- компонент `ChangeLogListener`;
- метод, помеченный `@JmsListener`.

Listener:
1. принимает JMS-сообщение;
2. проверяет его структуру;
3. сохраняет информацию об изменении в таблицу `log`.


### Задание 5
*Выберите типы событий, для которых необходимо отправлять уведомления.*

#### Реализация
Реализована система подписок на события, хранящаяся в таблице `notifications`.

Подписка содержит:
- email адрес;
- имя сущности (или `*`);
- тип изменения (INSERT / UPDATE / DELETE или `*`).


### Задание 6
*Разработайте MDB или MDP для отправки email-уведомлений.*

#### Реализация
В компоненте `NotificationService`:
- анализируется полученное JMS-сообщение;
- выбираются подходящие подписки из базы данных;
- при совпадении условий отправляется email-уведомление.

Для отправки писем используется `JavaMailSender`.
Конфигурация почты вынесена в класс `MailConfig`.

## Тестирование
 - Добавим врача
 - Обновим отчет
 - Удалим отчет

<img width="525" height="318" alt="Image" src="https://github.com/user-attachments/assets/b4a9d4c5-d5bd-4707-aa3d-3c3677097589" />

<img width="668" height="285" alt="Image" src="https://github.com/user-attachments/assets/8d2d0dd3-7a41-437b-bda7-7cc48cbc9b10" />

<img width="666" height="303" alt="Image" src="https://github.com/user-attachments/assets/b1ee3400-7caf-4b1f-a856-e07cae910acd" />

<img width="939" height="167" alt="Image" src="https://github.com/user-attachments/assets/8a846f42-1ea7-4d9a-8630-13e58e056008" />

<img width="333" height="128" alt="Image" src="https://github.com/user-attachments/assets/12d1b56b-4930-4a42-8c8b-edeb987b00d6" />
